generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Mission {
  id         String   @id @default(cuid())
  text       String
  type       String   // 'START' ou 'MID'
  category   String
  difficulty String   // 'easy', 'medium', 'hard'
  createdAt  DateTime @default(now())
  
  playerMissions PlayerMission[]
  
  @@index([type])
}

model Room {
  id              String    @id @default(cuid())
  code            String    @unique
  creatorToken    String    // Token pour identifier le cr√©ateur
  gameStarted     Boolean   @default(false)
  gameStartTime   DateTime?
  createdAt       DateTime  @default(now())
  
  players         Player[]
  
  @@index([code])
}

model Player {
  id              String   @id @default(cuid())
  name            String
  token           String   @unique // Token unique du joueur
  roomId          String
  room            Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())
  
  missions        PlayerMission[]
  
  @@index([roomId])
  @@index([token])
}

model PlayerMission {
  id              String   @id @default(cuid())
  playerId        String
  player          Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)
  missionId       String
  mission         Mission  @relation(fields: [missionId], references: [id])
  type            String   // 'START' ou 'MID'
  assignedAt      DateTime @default(now())
  
  @@unique([playerId, type])
  @@index([playerId])
}